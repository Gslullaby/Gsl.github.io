---
title: BIP 39
date: 2018-09-13 11:16:33
tags:
- 区块链
- BIP
keywords:
- BIP
- 区块链
categories:
- 区块链
description:
---
进入区块链行业已经一年有余，开发之余也一直在补充区块链知识，读过《区块链-技术驱动金融》，以及BTC白皮书BIP等，记录的比较零散，很有必要整理一下。首先先把比较重要的BIP翻译整理一遍。此篇BIP39的译文，是助记词相关知识

[原文链接](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)

## 概要
此篇BIP介绍如何为确定性钱包生成助记词或者助记句（一组容易记忆的单词）
本文包括两部分：
1. 生成助记词
2. 将助记词转化为二进制种子。种子可以用于生成BIP 32中所描述的确定性钱包

## 动机
原生的二进制信息/十六进制的钱包种子，对人们来说是很难记录并保存的，而且在保存的过程中也容易出错。如果换成一组单词或句子，则友好的多。句子可以很方便的写在纸上或其他隐秘的地方

## 生成助记词
#### 第一步 -- 生成初始熵
熵的位数必须为32的整数倍。熵越长，越安全，相应的助记词也就越多。这里定位熵的长度为ENT，ENT的取值范围为128位-256位
#### 第二步 -- 计算校验和
计算方式，对初始熵计算SHA256 hash，取其前 ENT/32 位作为校验和CS。
#### 第三部 -- 生成助记词
然后将校验和拼接在初始熵的尾部，即ENT+CS位数据，再划分为整数个11bit组，即（ENT+CS）/ 11组，记为MS，每个组可以编码为0-2047中的一个正整数，刚好对应于助记词表中的一个单词的下标。然后将分组按照下标转换为一组助记词

下图描述了ENT，CS，MS的关系    
{% asset_img ENT-CS-MS.png %}

#### 助记词表
一个理想的助记词表应该拥有以下特性
1. 选词聪明
> 所选的词应该满足通过单词的前四个字符就可以确定该单词    

2. 避免相近次出现
> 如'build'/'built'、'woman'/'women'、'quick'/'quickly'。这类相似词，不仅让记忆句子变得困难，而且也更容易出错

3. 助记词列表需要排序
> 有序的助记词列表，可以让词查找更加有效率，同时也可以使用前缀树，以便更好的压缩

注：助记词表可以包含本地字符，但是必须使用（NFKD）UTF-8编码

## 助记词转化为种子（seed）
有些用户可能想用passphrase对助记词进行加密。如果没有设置passphrase则使用“”空字符代替    
生成种子使用的是**PBKDF2**算法该算法的    
该算法的输入为
* 助记词作为password参数
* “mnemonic”+passphrase作为salt参数
* 迭代次数设置为2048
* 使用HMAC-SHA512作为伪随机数生成函数    

输出为
* 512位的种子

种子用于生成BIP 32中描述的确定性钱包（HD Wallet）    

由于seed的生成完全独立于mnemonic的生成，这使得代码非常简洁。并且对助记词没有任何限制，用户可以实现自己的单词表，甚至是整个助记词的生成

虽然可以使用其他算法生成的助记符，但不建议这样做，并且APP中必须使用助记词表计算助记词的校验和，如果无效则应该提示用户。

注：错误的passphrase虽然也能生成有效的seed，并且生成钱包，但只有正确的passphrase生成的seed，才能获取到拥有财产的钱包
